import{s as l,M as d,B as p,c as g,E as f,S as v}from"./chunk-f415f5ee.js";import{T as y,S as b,C as k,a as I,d as M}from"./chunk-bc2a8b7e.js";var w;(r=>{function e(s,t,o){l.sendMessage({type:d.Notification,reciver:s,payload:{type:"success",title:t,content:o}})}r.success=e;function a(s,t,o){l.sendMessage({type:d.Notification,reciver:s,payload:{type:"error",title:t,content:o}})}r.error=a})(w||(w={}));const n=w;p.runtime.onInstalled.addListener(()=>{p.contextMenus.create({id:"KubespiderMenu",title:"Send to Kubespider",contexts:["all"]})});p.contextMenus.onClicked.addListener(async(r,e)=>{if(r.menuItemId==="KubespiderMenu"){const a=(e==null?void 0:e.id)||await y.getCurrentTabId();let s=r.linkUrl;if((s===""||s==null)&&(s=e==null?void 0:e.url),s===""||s==null)return;const{server:t,token:o,captureCookies:c}=await b.read();if(!t||t===""){n.error(a,"Kubespider","Please set server address first!");return}const u=c?await k.getAll(s):void 0,i=await I(M(t,s,void 0,u,o));i.status===200?n.success(a,"Kubespider",`${s} download success`):n.error(a,"Kubespider",`${i.body}`)}});g.addListener(d.Download,async r=>{const{dataSource:e,path:a}=r,{server:s,token:t,captureCookies:o}=await b.read();if(!s||s==="")return f("Please set server address first");const c=await y.getCurrentTabId(),u=o?await k.getAll(e):void 0,i=await I(M(s,e,a,u,t));return i.status===200?(n.success(c,"Kubespider",`${e} download success`),v()):(n.error(c,"Kubespider",`${i.body}`),f())});g.addListener(d.Notification,async r=>{let{tabId:e}=r;return e?v():(e=await y.getCurrentTabId(),e===-1?f("No active tab"):l.sendMessage({type:d.Notification,reciver:e,payload:r}))});
